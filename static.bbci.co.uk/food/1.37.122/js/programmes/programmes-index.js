glow.ready(function(){function e(){if(glow.dom.get("#top-promo .top-promo-panel .top-promo-image").length>1){glow.dom.get("#top-promo").attr("style","display:none");var i="";promoItems=glow.dom.get("#top-promo .top-promo-panel .top-promo-image");i+='<div id="more-programmes" class="content-box related-resources">';i+="<h2>Recent food programmes ("+promoItems.length+")</h2>";i+='<ul class="carousel">';promoItems.each(function(j){i+="<li>";i+='<a href="#'+glow.dom.get(this).parent().attr("id")+'" class="img-link">';i+='<img src="'+glow.dom.get(this).attr("src")+'" width="146" height="82" alt="'+glow.dom.get(this).attr("alt")+'"/>';i+='<span class="episode-title">';i+=glow.dom.get(this).parent().get(".episode-title a").html();i+="</span>";i+="</a>";i+='<h3 class="programme-title">';i+='<a href="#'+glow.dom.get(this).parent().attr("id")+'">';i+=glow.dom.get(this).parent().get(".programme-title a").html();i+="</a>";i+="</h3>";i+='<span class="date">'+glow.dom.get(this).parent().get(".date").html()+"</span>";i+="</li>";if(j!=0){newImageSrc=glow.dom.get(this).attr("src").replace("160x90","608x342");glow.dom.get(this).attr("src","").attr("src",newImageSrc).attr("width","608").attr("height","342")}if(j==0){glow.dom.get(this).parent(".top-promo-panel-item").addClass("show")}else{glow.dom.get(this).parent(".top-promo-panel-item").addClass("hide")}});i+="</ul>";i+="</div>";glow.dom.create(i).insertAfter("#top-promo");glow.dom.get("#top-promo").addClass("js-vers");glow.dom.get("#top-promo").attr("style","display:block")}}e();glow.events.addListener("#top-promo .top-promo-image-overlay","mouseover",function(i){glow.dom.get(this).addClass("hover")});glow.events.addListener("#top-promo .top-promo-image-overlay","mouseout",function(i){glow.dom.get(this).removeClass("hover")});glow.events.addListener("#top-promo .top-promo-image-overlay","click",function(j){var i=glow.dom.get(this).children(".top-promo-image-panel").children("a.play-button").attr("href");window.location=i});var o=new Array();glow.dom.get("#top-promo .recipe-carousel-container .carousel").each(function(v){if(glow.dom.get(this).children().length>7){var j=glow.dom.get(this).parent().parent().parent().attr("id");j="id-"+String(v)+"-"+String(j);o[j]=new glow.widgets.Carousel(this,{vertical:true,size:7,step:7,theme:"light",className:"carousel-container",loop:false});var i=glow.dom.get(this).ancestors().get(".recipe-carousel-container").get(".carousel-next");i.html("Next recipes");var u=glow.dom.get(this).ancestors().get(".recipe-carousel-container").get(".carousel-prev");u.html("Previous recipes");glow.dom.get(this).css("height","auto");glow.dom.get(this).css("width","304px");glow.dom.get(this).ancestors().get(".recipe-carousel-container .carousel-window").css("height","201px")}});if(glow.dom.get("#more-programmes .carousel").length>0){var n=new glow.widgets.Carousel("#more-programmes .carousel",{className:"carousel-container",loop:false,size:6,step:1});glow.dom.get(".top-promo-panel-item.hide").css("display","none");var h=window.location.href;var d=h.split("#")[1];if(d==undefined||d=="blq-container"){var m=glow.dom.get("#more-programmes .carousel-item");m[0].className="carousel-item selected"}else{var m=glow.dom.get("#more-programmes .carousel-item");var k=glow.dom.get("a.img-link");for(var r=0;r<k.length;r++){if(k[r].href==h){m[r].className="carousel-item selected";var f=glow.dom.get(".top-promo-panel-item");for(var p=0;p<f.length;p++){if(f[p].id==d){glow.dom.get("#"+String(f[p].id)).css("display","block")}else{glow.dom.get("#"+String(f[p].id)).css("display","none")}}if(k.length>6){if(r<(k.length-6)){n.moveTo(r,true)}else{n.moveTo((k.length-6),true)}}setTimeout("window.location.href='#blq-container';",500);break}}}glow.events.addListener("#more-programmes .carousel-item","click",function(u){var j=glow.dom.get(this).children("a.img-link").attr("href").lastIndexOf("#")+1;var i=glow.dom.get(this).children("a.img-link").attr("href").substr(j);glow.dom.get(".top-promo-panel-item").css("display","none");glow.dom.get("#"+i).css("display","block");glow.dom.get("#more-programmes .carousel-item").removeClass("selected");glow.dom.get(this).addClass("selected");return false});glow.events.addListener("#more-programmes .carousel-item","mouseover",function(i){glow.dom.get(this).addClass("more-info")});glow.events.addListener("#more-programmes .carousel-item","mouseout",function(i){glow.dom.get(this).removeClass("more-info")})}function l(i,u){chefOptions="";chefDropdown="";if(i){h="/food/api/food/chefs/by/programme/all/cuisine/"+i+".json"}else{h="/food/api/food/chefs/by/programme/all.json"}var j=glow.net.get(h,{onLoad:function(v){var w=b(v.json());optionList=s(w,"chefs");chefDropdown='<select id="chefs-filter">'+optionList+"</select>";if(u==true){currentChef=document.getElementById("chefs-filter").options[document.getElementById("chefs-filter").selectedIndex].value;glow.dom.get("#chefs-filter").replaceWith(chefDropdown);document.getElementById("chefs-filter").value=currentChef}else{glow.dom.get("#all-programmes ul").before('<div id="filters">Filter by: <span>Chef</span>'+chefDropdown+"</div>")}c()},onError:function(v){},useCache:true})}l();function q(i,u){cuisineOptions="";cuisineDropdown="";if(i){h="/food/api/food/cuisines/by/programme/all/chef/"+i+".json"}else{h="/food/api/food/cuisines/by/programme/all.json"}var j=glow.net.get(h,{onLoad:function(v){var w=b(v.json());optionList=s(w,"cuisines");cuisineDropdown='<select id="cuisines-filter">'+optionList+"</select>";if(u==true){currentCuisine=document.getElementById("cuisines-filter").options[document.getElementById("cuisines-filter").selectedIndex].value;glow.dom.get("#cuisines-filter").replaceWith(cuisineDropdown);document.getElementById("cuisines-filter").value=currentCuisine}else{glow.dom.get("#chefs-filter").after(" <span>Cuisine</span>"+cuisineDropdown)}t()},onError:function(v){},useCache:true})}function s(v,u){optionList='<option value="">Please select</option>';for(var j in v){optionList+='<option value="'+v[j].id+'">'+v[j].displayName+"</option>"}return optionList}function c(){glow.events.addListener("#chefs-filter","change",function(i){glow.dom.get("#all-programmes ul").remove();glow.dom.get("#all-programmes .loading").remove();glow.dom.get("#filters").after('<div class="loading"></div>');chef=this.options[this.selectedIndex].value;cuisine="";a(chef,cuisine)})}function t(){glow.events.addListener("#cuisines-filter","change",function(i){cuisine=this.options[this.selectedIndex].value;chef=document.getElementById("chefs-filter").options[document.getElementById("chefs-filter").selectedIndex].value;l(cuisine,true);a(chef,cuisine)})}function g(w,u,j){listItems="";filter="";if(u!=""){filter+="&amp;chefs[0]="+u}if(cuisine!=""){filter+="&amp;cuisines[0]="+cuisine}programmeList="<ul>";count=0;for(var v in w){if(w[v].count===0){continue}if(w[v].type!=null&&w[v].typeName!=null){listItems+="<li";if(count%3==0){listItems+=' class="first"'}listItems+='><div><a class="see-all-search" href="/food/recipes/search?programmes[]='+w[v].type+filter+'">'+w[v].typeName+"</a> ("+w[v].count+")</div></li>"}count++}programmeList+=listItems;programmeList+="</ul>";glow.dom.get("#all-programmes ul").remove();glow.dom.get("#all-programmes .loading").remove();glow.dom.get("#filters").after(programmeList)}function a(j,i){query="";if(j!=""){query+="chef="+j}if(cuisine!=""){query+="&cuisine="+cuisine}var u=glow.net.get("/food/api/food/search/programmes.json?"+query+"&q=",{onLoad:function(v){var w=v.json().searchResults;g(w,j,cuisine)},onError:function(v){},useCache:true})}function b(x){var y={};for(var w in x.byProgramme){var j=x.byProgramme[w];for(var v in j.chefs){y[j.chefs[v].id]=j.chefs[v].displayName}}var z=[];for(var u in y){z.push({id:u,displayName:y[u]})}z.sort(function(A,i){return A.id.localeCompare(i.id)});return z}});